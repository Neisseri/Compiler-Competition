--------------------------- building ast ---------------------------
parse tree: 
(compUnit 
        (compUnitItem 
            (funcDef 
                (funcType 
                    (bType int)) get_one ( 
                (funcFParams 
                    (funcFParam 
                        (bType int) a)) ) 
                (block { 
                    (blockItem 
                        (stmt return 
                            (exp 
                                (addExp 
                                    (mulExp 
                                        (unaryExp 
                                            (primaryExp 
                                                (number 
                                                    (intConst 1))))))) ;)) }))) 
        (compUnitItem 
            (funcDef 
                (funcType 
                    (bType int)) deepWhileBr ( 
                (funcFParams 
                    (funcFParam 
                        (bType int) a) , 
                    (funcFParam 
                        (bType int) b)) ) 
                (block { 
                    (blockItem 
                        (decl 
                            (varDecl 
                                (bType int) 
                                (varDef c) ;))) 
                    (blockItem 
                        (stmt 
                            (lVal c) = 
                            (exp 
                                (addExp 
                                    (addExp 
                                        (mulExp 
                                            (unaryExp 
                                                (primaryExp 
                                                    (lVal a))))) + 
                                    (mulExp 
                                        (unaryExp 
                                            (primaryExp 
                                                (lVal b)))))) ;)) 
                    (blockItem 
                        (stmt while ( 
                            (cond 
                                (lOrExp 
                                    (lAndExp 
                                        (eqExp 
                                            (relExp 
                                                (relExp 
                                                    (addExp 
                                                        (mulExp 
                                                            (unaryExp 
                                                                (primaryExp 
                                                                    (lVal c)))))) < 
                                                (addExp 
                                                    (mulExp 
                                                        (unaryExp 
                                                            (primaryExp 
                                                                (number 
                                                                    (intConst 75))))))))))) ) 
                            (stmt 
                                (block { 
                                    (blockItem 
                                        (decl 
                                            (varDecl 
                                                (bType int) 
                                                (varDef d) ;))) 
                                    (blockItem 
                                        (stmt 
                                            (lVal d) = 
                                            (exp 
                                                (addExp 
                                                    (mulExp 
                                                        (unaryExp 
                                                            (primaryExp 
                                                                (number 
                                                                    (intConst 42))))))) ;)) 
                                    (blockItem 
                                        (stmt if ( 
                                            (cond 
                                                (lOrExp 
                                                    (lAndExp 
                                                        (eqExp 
                                                            (relExp 
                                                                (relExp 
                                                                    (addExp 
                                                                        (mulExp 
                                                                            (unaryExp 
                                                                                (primaryExp 
                                                                                    (lVal c)))))) < 
                                                                (addExp 
                                                                    (mulExp 
                                                                        (unaryExp 
                                                                            (primaryExp 
                                                                                (number 
                                                                                    (intConst 100))))))))))) ) 
                                            (stmt 
                                                (block { 
                                                    (blockItem 
                                                        (stmt 
                                                            (lVal c) = 
                                                            (exp 
                                                                (addExp 
                                                                    (addExp 
                                                                        (mulExp 
                                                                            (unaryExp 
                                                                                (primaryExp 
                                                                                    (lVal c))))) + 
                                                                    (mulExp 
                                                                        (unaryExp 
                                                                            (primaryExp 
                                                                                (lVal d)))))) ;)) 
                                                    (blockItem 
                                                        (stmt if ( 
                                                            (cond 
                                                                (lOrExp 
                                                                    (lAndExp 
                                                                        (eqExp 
                                                                            (relExp 
                                                                                (relExp 
                                                                                    (addExp 
                                                                                        (mulExp 
                                                                                            (unaryExp 
                                                                                                (primaryExp 
                                                                                                    (lVal c)))))) > 
                                                                                (addExp 
                                                                                    (mulExp 
                                                                                        (unaryExp 
                                                                                            (primaryExp 
                                                                                                (number 
                                                                                                    (intConst 99))))))))))) ) 
                                                            (stmt 
                                                                (block { 
                                                                    (blockItem 
                                                                        (decl 
                                                                            (varDecl 
                                                                                (bType int) 
                                                                                (varDef e) ;))) 
                                                                    (blockItem 
                                                                        (stmt 
                                                                            (lVal e) = 
                                                                            (exp 
                                                                                (addExp 
                                                                                    (mulExp 
                                                                                        (mulExp 
                                                                                            (unaryExp 
                                                                                                (primaryExp 
                                                                                                    (lVal d)))) * 
                                                                                        (unaryExp 
                                                                                            (primaryExp 
                                                                                                (number 
                                                                                                    (intConst 2))))))) ;)) 
                                                                    (blockItem 
                                                                        (stmt if ( 
                                                                            (cond 
                                                                                (lOrExp 
                                                                                    (lAndExp 
                                                                                        (eqExp 
                                                                                            (eqExp 
                                                                                                (relExp 
                                                                                                    (addExp 
                                                                                                        (mulExp 
                                                                                                            (unaryExp get_one ( 
                                                                                                                (funcRParams 
                                                                                                                    (funcRParam 
                                                                                                                        (exp 
                                                                                                                            (addExp 
                                                                                                                                (mulExp 
                                                                                                                                    (unaryExp 
                                                                                                                                        (primaryExp 
                                                                                                                                            (number 
                                                                                                                                                (intConst 0))))))))) )))))) == 
                                                                                            (relExp 
                                                                                                (addExp 
                                                                                                    (mulExp 
                                                                                                        (unaryExp 
                                                                                                            (primaryExp 
                                                                                                                (number 
                                                                                                                    (intConst 1))))))))))) ) 
                                                                            (stmt 
                                                                                (block { 
                                                                                    (blockItem 
                                                                                        (stmt 
                                                                                            (lVal c) = 
                                                                                            (exp 
                                                                                                (addExp 
                                                                                                    (mulExp 
                                                                                                        (mulExp 
                                                                                                            (unaryExp 
                                                                                                                (primaryExp 
                                                                                                                    (lVal e)))) * 
                                                                                                        (unaryExp 
                                                                                                            (primaryExp 
                                                                                                                (number 
                                                                                                                    (intConst 2))))))) ;)) })))) })))) })))) })))) 
                    (blockItem 
                        (stmt return 
                            (exp 
                                (addExp 
                                    (mulExp 
                                        (unaryExp 
                                            (primaryExp ( 
                                                (exp 
                                                    (addExp 
                                                        (mulExp 
                                                            (unaryExp 
                                                                (primaryExp 
                                                                    (lVal c)))))) )))))) ;)) }))) 
        (compUnitItem 
            (funcDef 
                (funcType 
                    (bType int)) main ( ) 
                (block { 
                    (blockItem 
                        (decl 
                            (varDecl 
                                (bType int) 
                                (varDef p = 
                                    (initVal 
                                        (exp 
                                            (addExp 
                                                (mulExp 
                                                    (unaryExp 
                                                        (primaryExp 
                                                            (number 
                                                                (intConst 2))))))))) ;))) 
                    (blockItem 
                        (stmt 
                            (lVal p) = 
                            (exp 
                                (addExp 
                                    (mulExp 
                                        (unaryExp deepWhileBr ( 
                                            (funcRParams 
                                                (funcRParam 
                                                    (exp 
                                                        (addExp 
                                                            (mulExp 
                                                                (unaryExp 
                                                                    (primaryExp 
                                                                        (lVal p))))))) , 
                                                (funcRParam 
                                                    (exp 
                                                        (addExp 
                                                            (mulExp 
                                                                (unaryExp 
                                                                    (primaryExp 
                                                                        (lVal p)))))))) ))))) ;)) 
                    (blockItem 
                        (stmt 
                            (exp 
                                (addExp 
                                    (mulExp 
                                        (unaryExp putint ( 
                                            (funcRParams 
                                                (funcRParam 
                                                    (exp 
                                                        (addExp 
                                                            (mulExp 
                                                                (unaryExp 
                                                                    (primaryExp 
                                                                        (lVal p)))))))) ))))) ;)) 
                    (blockItem 
                        (stmt return 
                            (exp 
                                (addExp 
                                    (mulExp 
                                        (unaryExp 
                                            (primaryExp 
                                                (number 
                                                    (intConst 0))))))) ;)) }))) <EOF>)
visitCompUnit
visitCompUnit: funcDef
construct funct block: get_one
visitPrimaryExp_ number
visitBlock done!
construct funct block done!
visitCompUnit: funcDef
construct funct block: deepWhileBr
visitVarDecl: int start
visitVarDecl: ident: c
visitAssign done!
visitPrimaryExp_ number
visit block stmt
visitVarDecl: int start
visitVarDecl: ident: d
visitPrimaryExp_ number
visitAssign done!
visitPrimaryExp_ number
visit block stmt
visitAssign done!
visitPrimaryExp_ number
visit block stmt
visitVarDecl: int start
visitVarDecl: ident: e
visitPrimaryExp_ number
visitAssign done!
visitCall ident: get_one
visitFuncRParams
visitPrimaryExp_ number
visitCall args_list size: 1
visitPrimaryExp_ number
visit block stmt
visitPrimaryExp_ number
visitAssign done!
visitBlock done!
visitBlock done!
visitBlock done!
visitBlock done!
visitPrimaryExp_ exp
visitBlock done!
construct funct block done!
visitCompUnit: funcDef
construct funct block: main
visitVarDecl: int start
visitVarDecl: ident: p
visitVarDecl: initVal
visitInit
visitPrimaryExp_ number
visitCall ident: deepWhileBr
visitFuncRParams
visitCall args_list size: 2
visitAssign done!
visitExprStmt
visitCall ident: putint
visitFuncRParams
visitCall args_list size: 1
visitPrimaryExp_ number
visitBlock done!
construct funct block done!
visitCompUnit end create new program
visitCompUnit end create new program end
------------------------------type check------------------------------
Info: visitProgramProgram
Info: visitFuncDefint @get_one(int @a)
Info: visitParamDefint @a
Info: visitBlock
Info: visitStatementReturn 1
Info: visitExpr1
Info: visitIntLiteralExpr1
ret->type 0x55fdd9fb12a0
Info: visitReturnStmtReturn 1function has returnscope id1
Info: visitFuncDefint @deepWhileBr(int @a, int @b)
Info: visitParamDefint @a
Info: visitParamDefint @b
Info: visitBlock
Info: visitVarDef int @c
Info: visitStatementAssign@c = @a+@b
Info: visitAssignStmtAssign@c = @a+@b
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitAssignStmtint
Info: visitExpr@a+@b
Info: visitBinopExpr@a+@b
Info: visitExpr@a
Info: visitLvalExpr@a
Info: visitExpr@b
Info: visitLvalExpr@b
Info: visitStatementWhile
Info: visitExpr@c<75
Info: visitBinopExpr@c<75
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitExpr75
Info: visitIntLiteralExpr75
ret->type 0x55fdd9fb1350
Info: visitStatement
Info: visitBlock
Info: visitVarDef int @d
Info: visitStatementAssign@d = 42
Info: visitAssignStmtAssign@d = 42
Info: visitExpr@d
Info: visitLvalExpr@d
Info: visitAssignStmtint
Info: visitExpr42
Info: visitIntLiteralExpr42
ret->type 0x55fdd9fb1160
Info: visitStatementIfElse
Info: visitExpr@c<100
Info: visitBinopExpr@c<100
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitExpr100
Info: visitIntLiteralExpr100
ret->type 0x55fdd9fb12d0
Info: visitStatement
Info: visitBlock
Info: visitStatementAssign@c = @c+@d
Info: visitAssignStmtAssign@c = @c+@d
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitAssignStmtint
Info: visitExpr@c+@d
Info: visitBinopExpr@c+@d
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitExpr@d
Info: visitLvalExpr@d
Info: visitStatementIfElse
Info: visitExpr@c>99
Info: visitBinopExpr@c>99
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitExpr99
Info: visitIntLiteralExpr99
ret->type 0x55fdd9fb1560
Info: visitStatement
Info: visitBlock
Info: visitVarDef int @e
Info: visitStatementAssign@e = @d*2
Info: visitAssignStmtAssign@e = @d*2
Info: visitExpr@e
Info: visitLvalExpr@e
Info: visitAssignStmtint
Info: visitExpr@d*2
Info: visitBinopExpr@d*2
Info: visitExpr@d
Info: visitLvalExpr@d
Info: visitExpr2
Info: visitIntLiteralExpr2
ret->type 0x55fdd9fb15e0
Info: visitStatementIfElse
Info: visitExprCall @get_one(0)==1
Info: visitBinopExprCall @get_one(0)==1
Info: visitExprCall @get_one(0)
Info: visiCalltExprCall @get_one(0)
Info: visitExpr0
Info: visitIntLiteralExpr0
ret->type 0x55fdd9fb1660
Info: visitExpr1
Info: visitIntLiteralExpr1
ret->type 0x55fdd9fb16e0
Info: visitStatement
Info: visitBlock
Info: visitStatementAssign@c = @e*2
Info: visitAssignStmtAssign@c = @e*2
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitAssignStmtint
Info: visitExpr@e*2
Info: visitBinopExpr@e*2
Info: visitExpr@e
Info: visitLvalExpr@e
Info: visitExpr2
Info: visitIntLiteralExpr2
ret->type 0x55fdd9fb1710
Info: visitStatementReturn @c
Info: visitExpr@c
Info: visitLvalExpr@c
Info: visitReturnStmtReturn @c#4function has returnscope id3
Info: visitFuncDefint @main()
Info: visitBlock
Info: visitVarDef int @p = 2
Info: visitExpr2
Info: visitAssignmentExpr2
Info: visitExpr2
Info: visitIntLiteralExpr2
ret->type 0x55fdd9fb1740
Info: visitStatementAssign@p = Call @deepWhileBr(@p, @p)
Info: visitAssignStmtAssign@p = Call @deepWhileBr(@p, @p)
Info: visitExpr@p
Info: visitLvalExpr@p
Info: visitAssignStmtint
Info: visitExprCall @deepWhileBr(@p, @p)
Info: visiCalltExprCall @deepWhileBr(@p, @p)
Info: visitExpr@p
Info: visitLvalExpr@p
Info: visitExpr@p
Info: visitLvalExpr@p
Info: visitStatementCall @putint(@p)
Info: visitExprStmtCall @putint(@p)
Info: visitExprCall @putint(@p)
Info: visiCalltExprCall @putint(@p)
Info: use of undeclared function putint
Info: visitExpr@p
Info: visitLvalExpr@p
Info: visitStatementReturn 0
Info: visitExpr0
Info: visitIntLiteralExpr0
ret->type 0x55fdd9fb17d0
Info: visitReturnStmtReturn 0function has returnscope id10
ast: 
Program
  int @get_one(int @a#1)
    {
      Return 1
    }
  int @deepWhileBr(int @a#3, int @b#3)
    {
      int @c#4
      Assign@c#4 = @a#3+@b#3
      While        @c#4<75
        {
          int @d#6
          Assign@d#6 = 42
          If            @c#4<100
            {
              Assign@c#4 = @c#4+@d#6
              If                @c#4>99
                {
                  int @e#8
                  Assign@e#8 = @d#6*2
                  If                    Call @get_one(0)==1
                    {
                      Assign@c#4 = @e#8*2
                    }
                }
            }
        }
      Return @c#4
    }
  int @main()
    {
      int @p#11 = 2
      Assign@p#11 = Call @deepWhileBr(@p#11, @p#11)
      Call @putint
        @p#11
      Return 0
    }
End of Program
--------------------------- building ir ---------------------------
visitProgram
visitFunction get_one
visitFunction param decl: a#1
visitBlock 
visitStatement
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
function get_one has 3 regs
B0:
  prev: 
  succ: 
B1:
  prev: 
  succ: 

B0:
  prev: 
  succ: 

entryB0
reverse_postorderB0
B0:
  doms: 
  domed_by: B0 

B0:
  DF: 

visitFunction deepWhileBr
visitFunction param decl: a#3
visitFunction param decl: b#3
visitBlock 
visitStatement
visitExpression
visitExpression
visitExpressionLValue a#3
visitExpression
visitExpressionLValue b#3
visitStatement
visitExpression
visitExpression
visitExpressionLValue c#4
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitBlock 
visitStatement
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitExpression
visitExpression
visitExpressionLValue c#4
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitBlock 
visitStatement
visitExpression
visitExpression
visitExpressionLValue c#4
visitExpression
visitExpressionLValue d#6
visitStatement
visitExpression
visitExpression
visitExpressionLValue c#4
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitBlock 
visitStatement
visitExpression
visitExpression
visitExpressionLValue d#6
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitExpression
visitExpression
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitBlock 
visitStatement
visitExpression
visitExpression
visitExpressionLValue e#8
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitExpression
visitExpressionLValue c#4
function deepWhileBr has 34 regs
B2:
  prev: 
  succ: B3 
B3:
  prev: B2 B8 
  succ: B4 B5 
B4:
  prev: B3 
  succ: B6 
B5:
  prev: B3 
  succ: 
B6:
  prev: B4 
  succ: B7 B8 
B7:
  prev: B6 
  succ: B9 
B8:
  prev: B6 B11 
  succ: B3 
B9:
  prev: B7 
  succ: B10 B11 
B10:
  prev: B9 
  succ: B12 
B11:
  prev: B9 B14 
  succ: B8 
B12:
  prev: B10 
  succ: B13 B14 
B13:
  prev: B12 
  succ: B14 
B14:
  prev: B12 B13 
  succ: B11 
B15:
  prev: 
  succ: 

B2:
  prev: 
  succ: B3 
B3:
  prev: B2 B8 
  succ: B4 B5 
B4:
  prev: B3 
  succ: B6 
B5:
  prev: B3 
  succ: 
B6:
  prev: B4 
  succ: B7 B8 
B7:
  prev: B6 
  succ: B9 
B8:
  prev: B6 B11 
  succ: B3 
B9:
  prev: B7 
  succ: B10 B11 
B10:
  prev: B9 
  succ: B12 
B11:
  prev: B9 B14 
  succ: B8 
B12:
  prev: B10 
  succ: B13 B14 
B13:
  prev: B12 
  succ: B14 
B14:
  prev: B12 B13 
  succ: B11 

entryB2
B3
B4
B5
B6
B7
B8
B9
B10
B11
B12
B13
B14
reverse_postorderB2
reverse_postorderB3
reverse_postorderB5
reverse_postorderB4
reverse_postorderB6
reverse_postorderB7
reverse_postorderB9
reverse_postorderB10
reverse_postorderB12
reverse_postorderB13
reverse_postorderB14
reverse_postorderB11
reverse_postorderB8
reverse_postorderB2
reverse_postorderB3
reverse_postorderB5
reverse_postorderB4
reverse_postorderB6
reverse_postorderB7
reverse_postorderB9
reverse_postorderB10
reverse_postorderB12
reverse_postorderB13
reverse_postorderB14
reverse_postorderB11
reverse_postorderB8
B2:
  doms: B3 
  domed_by: B2 
B3:
  doms: B4 B5 
  domed_by: B2 B3 
B4:
  doms: B6 
  domed_by: B2 B3 B4 
B5:
  doms: 
  domed_by: B2 B3 B5 
B6:
  doms: B7 B8 
  domed_by: B2 B3 B4 B6 
B7:
  doms: B9 
  domed_by: B2 B3 B4 B6 B7 
B8:
  doms: 
  domed_by: B2 B3 B4 B6 B8 
B9:
  doms: B10 B11 
  domed_by: B2 B3 B4 B6 B7 B9 
B10:
  doms: B12 
  domed_by: B2 B3 B4 B6 B7 B9 B10 
B11:
  doms: 
  domed_by: B2 B3 B4 B6 B7 B9 B11 
B12:
  doms: B13 B14 
  domed_by: B2 B3 B4 B6 B7 B9 B10 B12 
B13:
  doms: 
  domed_by: B2 B3 B4 B6 B7 B9 B10 B12 B13 
B14:
  doms: 
  domed_by: B2 B3 B4 B6 B7 B9 B10 B12 B14 

B2:
  DF: 
B3:
  DF: 
B4:
  DF: B3 
B5:
  DF: 
B6:
  DF: B3 
B7:
  DF: B8 
B8:
  DF: B3 
B9:
  DF: B8 
B10:
  DF: B11 
B11:
  DF: B8 
B12:
  DF: B11 
B13:
  DF: B14 
B14:
  DF: B11 

visitFunction main
visitBlock 
visitExpression
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
visitStatement
visitExpression
visitExpression
visitExpressionLValue p#11
visitExpression
visitExpressionLValue p#11
visitStatement
visitExpression
visitExpression
visitExpressionLValue p#11
visitStatement
visitExpression
visitExpressionintliteral
visitExpressionintliteral done
function main has 8 regs
B16:
  prev: 
  succ: 
B17:
  prev: 
  succ: 

B16:
  prev: 
  succ: 

entryB16
reverse_postorderB16
B16:
  doms: 
  domed_by: B16 

B16:
  DF: 

ir:
; module
define i32 @main(){
B16:
  %2 = 2
  %3 = call i32 @deepWhileBr(i32 %2, i32 %2)
  %6 = call i32 @putint(i32 %3)
  %8 = 0
  ret i32 %8

}
define i32 @deepWhileBr(i32, i32){
B2:
  %8 = add i32 %1, %2
  br label B3

B3:
  %9 = phi i32 [ %15, B8 ]
  %10 = phi i32 [ %13, B8 ]
  %11 = phi i32 [ %8, B2 ], [ %16, B8 ]
  %10 = 75
  %11 = icmp slt i32 %11, %10
  br i32 %11, label B4, label B5

B4:
  %13 = 42
  br label B6

B5:
  ret i32 %11

B6:
  %15 = 100
  %16 = icmp slt i32 %11, %15
  br i32 %16, label B7, label B8

B7:
  %19 = add i32 %11, %13
  br label B9

B8:
  %15 = phi i32 [ %9, B6 ], [ %13, B11 ]
  %16 = phi i32 [ %11, B6 ], [ %14, B11 ]
  br label B3

B9:
  %21 = 99
  %22 = icmp sgt i32 %19, %21
  br i32 %22, label B10, label B11

B10:
  %25 = 2
  %26 = mul i32 %13, %25
  br label B12

B11:
  %13 = phi i32 [ %9, B9 ], [ %26, B14 ]
  %14 = phi i32 [ %19, B9 ], [ %12, B14 ]
  br label B8

B12:
  %28 = 0
  %27 = call i32 @get_one(i32 %28)
  %29 = 1
  %30 = icmp eq i32 %27, %29
  br i32 %30, label B13, label B14

B13:
  %32 = 2
  %33 = mul i32 %26, %32
  br label B14

B14:
  %12 = phi i32 [ %19, B12 ], [ %33, B13 ]
  br label B11

}
define i32 @get_one(i32){
B0:
  %3 = 1
  ret i32 %3

}
--------------------------- building riscv ---------------------------
riscv: 
T[-15] B9
T[-13] B9
T[-8] B3
T[-16] B9
T[-9] B7
T[-13] B12
T[-11] B7
T[-14] B12
T[-9] B10
T[-26] B15
T[-19] B10
T[-12] B15
T[-19] B13
T[-33] B14
?
get_one
get_one Main()
get_one
after compute reg_used
after prologue
end of emitend
deepWhileBr
deepWhileBr Main()
deepWhileBr
after compute reg_used
after prologue
end of emitend
main
main Main()
main
after compute reg_used
after prologue
end of emitend
